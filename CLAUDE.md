# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository: unirun

A JavaScript/Node.js voxel game project by Unicity Labs that demonstrates blockchain-based player state management using Unicity Tokens.

## Project Overview

Unicity Runner Demo - A single-player 3D voxel game with:
- Procedural maze generation with rooms and corridors
- Token-based player state persistence
- Enemy AI and combat mechanics
- Offline mode with localStorage (network integration ready but disabled)

## Essential Commands

```bash
# Initial setup
npm install
npm run build-sdk    # REQUIRED: Build Unicity SDK bundle before running dev

# Development
npm run dev          # Start Vite dev server on http://localhost:3000

# Production
npm run build        # Build for production
npm run preview      # Preview production build
```

## Architecture

### Tech Stack
- **Vite** - Build tool and dev server
- **noa-engine** - Voxel game engine (built on Babylon.js)
- **Unicity SDK** - Blockchain state management
- **Webpack** - SDK bundler with Node.js polyfills for browser

### Key Files
- `main.js` (~931 lines) - Core game logic, token management, world generation
- `network.js` - Multiplayer stubs (future implementation)
- `unicity-integration.js` - Network integration (currently unused)
- `sdk-bundler/` - Webpack config for bundling Unicity SDK
- `public/unicity-sdk.js` - Bundled SDK output (generated by build-sdk)

### Core Patterns

1. **Token State Management**
   - Player data (position, health, score) stored in Unicity tokens
   - Serialized to localStorage (offline mode)
   - State updates every 10 seconds via setInterval

2. **World Generation**
   - Deterministic using `WORLD_SEED` constant
   - Chunk-based (32x32 blocks)
   - 40% room probability per chunk
   - Color-coded corridors: red (east), blue (north), yellow (west)

3. **SDK Integration**
   - SDK bundled via Webpack with browser polyfills
   - UMD format output for browser compatibility
   - Accessed via global `UnicitySDK` object

### Development Notes

- SDK must be built (`npm run build-sdk`) before starting dev server
- Game runs in offline mode - tokens stored in localStorage only
- Network integration code exists but is commented out (requires credentials)
- Test SDK functionality using `test-sdk.html`